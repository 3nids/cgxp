<!DOCTYPE html>
<html debug="true">
  <head>
    <script src="../../../../../ext/Ext/adapter/ext/ext-base.js"></script>
    <script src="../../../../../ext/Ext//ext-all-debug.js"></script>
    <script type="text/javascript" src="../../../../../openlayers/lib/OpenLayers.js"></script>
    <script type="text/javascript" src="../../../../../geoext/lib/GeoExt.js"></script>
    <script type="text/javascript" src="../../../../../gxp/src/script/loader.js"></script>
    <script type="text/javascript" src="../../../../src/script/CGXP/loader.js"></script>

    <script type="text/javascript">

        function test_constructor(t) {
            t.plan(2);

            var ts = new cgxp.plugins.ThemeSelector();
            t.ok(ts instanceof gxp.plugins.Tool,
                 'cgxp.plugins.ThemeSelector creates a tool');
            t.ok(ts instanceof cgxp.plugins.ThemeSelector,
                 'cgxp.plugins.ThemeSelector a theme selector');
        }

        function test_addOutput(t) {
            t.plan(14);

            var themes = {
                local: [{
                    name: 'localname1',
                    icon: 'localicon1',
                    children: []
                }, {
                    name: 'localname2',
                    icon: 'localicon2',
                    children: []
                }],
                external: [{
                    name: 'externalname1',
                    icon: 'externalicon1',
                    children: []
                }, {
                    name: 'externalname2',
                    icon: 'externalicon2',
                    children: []
                }]
            };

            var ts = new cgxp.plugins.ThemeSelector({themes: themes});

            var output = ts.addOutput({extra: 'extra'});
            t.ok(output instanceof Ext.Button,
                 'addOutput return a button');
            t.eq(output.extra, 'extra',
                 'the button has an extra property');
            t.ok(output.menu instanceof Ext.menu.Menu,
                 'the button has a menu');
            t.eq(output.menu.items.length, 1,
                 'the menu has one item');
            t.ok(output.menu.getComponent(0) instanceof Ext.Container,
                 'the menu includes a container');
            t.eq(output.menu.getComponent(0).items.length, 1,
                 'the container has one item');
            t.ok(output.menu.getComponent(0).getComponent(0)
                    instanceof Ext.TabPanel,
                 'the item is a tab panel');
            var tabPanel = output.menu.getComponent(0).getComponent(0);
            t.eq(tabPanel.items.length, 2,
                 'the tab panel has two tabs');
            t.ok(tabPanel.getComponent(0) instanceof Ext.DataView,
                 'first tab is a data view');
            t.ok(tabPanel.getComponent(1) instanceof Ext.DataView,
                 'second tab is a data view');
            t.eq(tabPanel.getComponent(0).getStore().getCount(), 2,
                 'first dataview store includes 2 records');
            t.eq(tabPanel.getComponent(1).getStore().getCount(), 2,
                 'second dataview store includes 2 records');
            t.eq(tabPanel.getComponent(0).getStore().getAt(0).get('name'),
                 'localname1',
                 'first dataview store includes expected data');
            t.eq(tabPanel.getComponent(1).getStore().getAt(0).get('name'),
                 'externalname1',
                 'second dataview store includes expected data');
        }

    </script>

  </head>
  <body>
  </body>
</html>
